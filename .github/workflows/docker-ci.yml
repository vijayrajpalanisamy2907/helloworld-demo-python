name: Docker CI Pipeline
 
run-name: ${{ github.actor }} is running out Docker CI Pipeline ðŸš€
 
on: [push]
 
jobs:
 
  hello-world-job:
 
    runs-on: ubuntu-latest
 
    steps:
 
       - name: Clone the code
 
         uses: actions/checkout@v6
 
       - name: Build the image
 
         run: docker build -t ${{ vars.DOCKERHUB_USERNAME }}/helloworld-github-python:v1 .
 
       - name: Login to Docker Hub
 
         uses: docker/login-action@v3
 
         with:
 
           username: ${{ vars.DOCKERHUB_USERNAME }}
 
           password: ${{ secrets.DOCKERHUB_PASSWORD }}
 
       - name: Push the image
 
         run: docker push ${{ vars.DOCKERHUB_USERNAME }}/helloworld-github-python:v1
       - name: Run the container
 
         run: docker run --name helloworld-demo-python -itd -p 8080:8080 ${{ vars.DOCKERHUB_USERNAME }}/helloworld-github-python:v1
 
       - name: View the container
 
         run: docker ps
 
  k8s-implementation:
 
    needs: hello-world-job
 
    runs-on: ubuntu-latest
 
    steps:
 
       - name: Clone the code
 
         uses: actions/checkout@v6  
       - name: Start minikube
 
         uses: medyagh/setup-minikube@latest
 
       - name: Try the cluster!
 
         run: kubectl get pods -A
       - name: Create Deployment and Service
 
         run: |
 
            kubectl apply -f k8s/nginx-deployment.yaml
 
            kubectl apply -f k8s/service.yaml
 
            kubectl wait --for=condition=ready pod -l app=helloworld-demo-python
 
       - name: View Deployment and Service
 
         run: |
 
            kubectl get deployments
 
            kubectl get service
